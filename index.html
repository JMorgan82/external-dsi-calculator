<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>External Downstream Injector Calculator</title>

  <style>
    :root { 
      --bg:#0b0f14; 
      --card:#121824; 
      --text:#e7eefc; 
      --muted:#9ab0d0; 
      --line:#22304a; 
      --accent:#63b3ff;
      --accent2:#2f5ea0;
      --panel:#0d1420;
      --panel2:#0a111c;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg,#070b10,#0b0f14);
      color:var(--text);
    }

    .wrap { max-width: 860px; margin: 0 auto; padding: 28px 16px 60px; }

    h1 { margin: 0 0 8px; font-size: 22px; letter-spacing:.2px; }
    .sub { color:var(--muted); margin:0 0 18px; }

    .nav { display:flex; gap:10px; margin-bottom:14px; }
    .linkbtn {
      text-decoration:none;
      border:1px solid #2a3a58;
      background:#0d1420;
      color:var(--text);
      padding:8px 12px;
      border-radius:10px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .linkbtn.active {
      border-color:var(--accent2);
      background: linear-gradient(180deg,#1a3c66,#12304f);
    }

    .card {
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      box-shadow:0 12px 40px rgba(0,0,0,.35);
    }

    .grid { display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width:720px){ .grid{ grid-template-columns:1fr 1fr; } }

    label { font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
    select, input {
      width:100%;
      padding:11px 12px;
      border-radius:10px;
      border:1px solid var(--line);
      background:var(--panel);
      color:var(--text);
      outline:none;
    }

    .row { display:flex; gap:10px; align-items:center; margin-top:10px; }
    .btn {
      border:1px solid #2a3a58;
      background:linear-gradient(180deg,#1a3c66,#12304f);
      color:var(--text);
      padding:11px 14px;
      border-radius:12px;
      font-weight:600;
      cursor:pointer;
    }

    .result {
      margin-top:14px;
      padding:14px;
      border-radius:12px;
      border:1px dashed #2a3a58;
      background:var(--panel2);
    }

    .big { font-size:18px; font-weight:800; margin:0 0 6px; }
    .small { font-size:13px; color:var(--muted); margin:0; }

    .tableWrap {
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:12px;
      overflow:hidden;
      background:rgba(0,0,0,.08);
    }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; border-bottom:1px solid var(--line); font-size:13px; }
    th { background:#0d1522; text-align:left; }
    tr:last-child td { border-bottom:none; }

    .bestRow td {
      background: linear-gradient(180deg, rgba(99,179,255,.18), rgba(99,179,255,.06));
    }
    .pill {
      display:inline-block;
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(99,179,255,.45);
      color:var(--text);
      margin-left:8px;
      vertical-align:middle;
    }

    .notice {
      margin-top:12px;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0b1320;
    }
    .notice p { margin:0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>External Downstream Injector Calculator</h1>
    <p class="sub">
      Choose your external injector type + GPM, enter stock % and desired output %, then get the recommended insert.
    </p>

    <div class="nav">
      <a class="linkbtn active" href="./index.html">External Injector Calculator</a>
      <a class="linkbtn" href="./downstream-injector.html">Regular Downstream Injector</a>
    </div>

    <div class="card">
      <div class="grid">
        <div>
          <label>External Injector Type</label>
          <select id="brand">
            <option value="xjet">X-Jet® style (Color Inserts)</option>
            <option value="joejet">JOEJET™ style (Alphabet Inserts)</option>
            <option value="fixfans">FIXFANS™ style (Alphabet Inserts)</option>
          </select>
        </div>

        <div>
          <label>Pressure Washer Flow (GPM)</label>
          <select id="gpm">
            <option value="2">2 GPM</option>
            <option value="3">3 GPM</option>
            <option value="4" selected>4 GPM</option>
            <option value="5">5 GPM</option>
            <option value="6">6 GPM</option>
            <option value="8">8 GPM</option>
          </select>
        </div>

        <div>
          <label>Stock Chemical Strength (%)</label>
          <input id="stock" type="number" value="12.5" step="0.1" min="0" />
        </div>

        <div>
          <label>Desired Output Strength (%)</label>
          <input id="desired" type="number" value="1.5" step="0.1" min="0" />
        </div>
      </div>

      <div class="row">
        <button class="btn" id="calc" type="button">Calculate</button>
      </div>

      <div class="result" id="result" style="display:none;"></div>
      <div class="tableWrap" id="tableWrap" style="display:none;"></div>

      <div class="notice">
        <p class="small">
          <strong>Disclaimer:</strong> Results are estimates. Actual draw varies by hose length, injector condition,
          nozzle choice, temperature, and chemical viscosity. Brand names are used for identification only.
          Not affiliated with any manufacturer.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Ratios are "Water : 1 part Chem" (e.g., 10 means 10:1)
    // Output % at gun estimated by: stock% / (ratio + 1)

    const XJET_COLOR_INSERTS = [
      { label:"OPEN",      ratios:{2:0.8, 3:1.2, 4:1.6, 5:2,   6:2.4, 8:3} },
      { label:"GREY",      ratios:{2:1.4, 3:2,   4:2.5, 5:3,   6:4,   8:4.9} },
      { label:"BLACK",     ratios:{2:3,   3:4,   4:5,   5:6.5, 6:8,   8:11} },
      { label:"BEIGE",     ratios:{2:6,   3:8,   4:10,  5:13,  6:16,  8:20} },
      { label:"RED",       ratios:{2:9,   3:12,  4:16,  5:20,  6:24,  8:28} },
      { label:"WHITE",     ratios:{2:16,  3:22,  4:30,  5:38,  6:45,  8:51} },
      { label:"BLUE",      ratios:{2:20,  3:27,  4:37,  5:46,  6:55,  8:61} },
      { label:"TAN (MED)", ratios:{2:28,  3:38,  4:50,  5:64,  6:77,  8:85} },
      { label:"GREEN",     ratios:{2:31,  3:42,  4:57,  5:70,  6:85,  8:90} },
      { label:"ORANGE",    ratios:{2:35,  3:48,  4:64,  5:80,  6:96,  8:102} },
      { label:"BROWN",     ratios:{2:48,  3:66,  4:88,  5:110, 6:133, 8:145} },
      { label:"YELLOW",    ratios:{2:70,  3:96,  4:128, 5:158, 6:191, 8:215} },
      { label:"AQUA",      ratios:{2:94,  3:128, 4:170, 5:215, 6:257, 8:284} },
      { label:"PURPLE",    ratios:{2:146, 3:200, 4:240, 5:300, 6:400, 8:501} },
      { label:"PINK",      ratios:{2:280, 3:353, 4:500, 5:480, 6:766, 8:906} }
    ];

    const ALPHABET_INSERTS = [
      { label:"A", ratios:{2:1.4, 3:2,   4:2.5, 5:3,   6:4,   8:4.9} },
      { label:"B", ratios:{2:3,   3:4,   4:5,   5:6.5, 6:8,   8:11} },
      { label:"C", ratios:{2:6,   3:8,   4:10,  5:13,  6:16,  8:20} },
      { label:"E", ratios:{2:9,   3:12,  4:16,  5:20,  6:24,  8:28} },
      { label:"F", ratios:{2:16,  3:22,  4:30,  5:38,  6:45,  8:51} },
      { label:"G", ratios:{2:20,  3:27,  4:37,  5:46,  6:55,  8:61} },
      { label:"H", ratios:{2:28,  3:38,  4:50,  5:64,  6:77,  8:85} },
      { label:"J", ratios:{2:31,  3:42,  4:57,  5:70,  6:85,  8:90} },
      { label:"K", ratios:{2:35,  3:48,  4:64,  5:80,  6:96,  8:102} },
      { label:"L", ratios:{2:48,  3:66,  4:88,  5:110, 6:133, 8:145} },
      { label:"M", ratios:{2:70,  3:96,  4:128, 5:158, 6:191, 8:215} },
      { label:"N", ratios:{2:94,  3:128, 4:170, 5:215, 6:257, 8:284} },
      { label:"P", ratios:{2:146, 3:200, 4:240, 5:300, 6:400, 8:501} },
      { label:"Q", ratios:{2:280, 3:383, 4:500, 5:480, 6:766, 8:906} }
    ];

    function outputPercent(stockPct, ratio) {
      return stockPct / (ratio + 1);
    }
    function toNum(v){
      const n = Number(v);
      return Number.isFinite(n) ? n : NaN;
    }
    function pct(n){ return `${n.toFixed(2)}%`; }
    function show(el){ el.style.display = "block"; }
    function hide(el){ el.style.display = "none"; }

    function renderResults({ title, subtitle, gpmNum, stockPct, desiredPct, inserts }) {
      const rows = inserts
        .map(ins => {
          const ratio = ins.ratios[gpmNum];
          const out = outputPercent(stockPct, ratio);
          return { ...ins, out, diff: Math.abs(out - desiredPct) };
        })
        .sort((a,b)=>a.diff-b.diff);

      const best = rows[0];

      const resultEl = document.getElementById("result");
      const tableEl = document.getElementById("tableWrap");

      show(resultEl);
      show(tableEl);

      resultEl.innerHTML = `
        <p class="big">${title}: ${best.label} <span class="pill">Recommended</span></p>
        <p class="small">${subtitle}</p>
        <p class="small">Estimated output at gun: <strong>${pct(best.out)}</strong> (target: ${pct(desiredPct)}) • Stock ${pct(stockPct)} • ${gpmNum} GPM</p>
      `;

      tableEl.innerHTML = `
        <table>
          <tr>
            <th>Insert</th>
            <th>Estimated Output %</th>
          </tr>
          ${rows.map(r => `
            <tr class="${r.label === best.label ? "bestRow" : ""}">
              <td>${r.label}${r.label === best.label ? `<span class="pill">Best Match</span>` : ""}</td>
              <td>${pct(r.out)}</td>
            </tr>
          `).join("")}
        </table>
      `;
    }

    const calcBtn = document.getElementById("calc");
    const brandEl = document.getElementById("brand");
    const gpmEl = document.getElementById("gpm");
    const stockEl = document.getElementById("stock");
    const desiredEl = document.getElementById("desired");

    const resultEl = document.getElementById("result");
    const tableEl = document.getElementById("tableWrap");

    calcBtn.addEventListener("click", () => {
      const brand = brandEl.value;
      const gpmNum = toNum(gpmEl.value);
      const stockPct = toNum(stockEl.value);
      const desiredPct = toNum(desiredEl.value);

      hide(resultEl);
      hide(tableEl);
      resultEl.innerHTML = "";
      tableEl.innerHTML = "";

      if (!Number.isFinite(gpmNum) || !Number.isFinite(stockPct) || !Number.isFinite(desiredPct)) {
        show(resultEl);
        resultEl.innerHTML = `<p class="big">Check your inputs</p><p class="small">Please enter valid numbers for stock % and desired output %.</p>`;
        return;
      }
      if (stockPct <= 0 || desiredPct <= 0) {
        show(resultEl);
        resultEl.innerHTML = `<p class="big">Check your inputs</p><p class="small">Stock % and desired output % must be greater than 0.</p>`;
        return;
      }
      if (desiredPct > stockPct) {
        show(resultEl);
        resultEl.innerHTML = `<p class="big">Desired output is higher than stock</p><p class="small">Desired output % cannot exceed stock %.</p>`;
        return;
      }

      if (brand === "xjet") {
        renderResults({
          title: "Recommended Color Insert",
          subtitle: "X-Jet® style (Color Inserts)",
          gpmNum, stockPct, desiredPct,
          inserts: XJET_COLOR_INSERTS
        });
        return;
      }

      // JOEJET™ and FIXFANS™ share the alphabet insert chart
      renderResults({
        title: "Recommended Alphabet Insert",
        subtitle: brand === "joejet" ? "JOEJET™ style (Alphabet Inserts)" : "FIXFANS™ style (Alphabet Inserts)",
        gpmNum, stockPct, desiredPct,
        inserts: ALPHABET_INSERTS
      });
    });
  </script>
</body>
</html>
