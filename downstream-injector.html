<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Downstream Injector Dilution Calculator</title>
  <style>
    :root {
      --bg:#0b0f14; --card:#121824; --text:#e7eefc;
      --muted:#9ab0d0; --line:#22304a;
      --accent:#63b3ff; --warn:#ffd18a;
    }
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg,#070b10,#0b0f14);
      color:var(--text);
    }

    .wrap { max-width: 860px; margin: 0 auto; padding: 28px 16px 60px; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    .sub { color:var(--muted); margin:0 0 18px; }

    .nav { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px; }
    .linkbtn {
      text-decoration:none;
      border:1px solid #2a3a58;
      background:#0d1420;
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      font-size:13px;
    }

    .card {
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
    }

    .grid { display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width:720px){ .grid{ grid-template-columns:1fr 1fr; } }

    label { font-size:12px; color:var(--muted); }
    select, input {
      width:100%;
      padding:11px 12px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0d1420;
      color:var(--text);
    }

    .btn {
      cursor:pointer;
      border:1px solid #2a3a58;
      background:linear-gradient(180deg,#1a3c66,#12304f);
      color:var(--text);
      padding:11px 14px;
      border-radius:12px;
      font-weight:600;
    }

    .result {
      margin-top:14px;
      padding:14px;
      border-radius:12px;
      border:1px dashed #2a3a58;
      background:#0a111c;
    }

    .big { font-size:18px; font-weight:800; }
    .small { font-size:13px; color:var(--muted); line-height:1.45; }
    .warn { color:var(--warn); }

    .table { margin-top:12px; border:1px solid var(--line); border-radius:12px; overflow:hidden; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; border-bottom:1px solid var(--line); font-size:13px; }
    th { background:#0d1522; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Downstream Injector Dilution Calculator</h1>
    <p class="sub">
      Choose your downstream injector + GPM, enter stock % and desired output %, then get batch mix recipes.
    </p>

    <div class="nav">
      <a class="linkbtn" href="./index.html">External Injector Calculator</a>
      <a class="linkbtn" href="./downstream-injector.html">Regular Downstream Injector</a>
    </div>

    <div class="card">
      <div class="grid">
        <div>
          <label>Downstream Injector Type</label>
          <select id="inj"></select>
        </div>

        <div>
          <label>Machine Flow (GPM)</label>
          <select id="gpm"></select>
        </div>

        <div>
          <label>Stock Chemical Strength (%)</label>
          <input id="stock" type="number" value="12.5" />
        </div>

        <div>
          <label>Desired Output at Gun (%)</label>
          <input id="desired" type="number" value="1.0" />
        </div>
      </div>

      <button class="btn" id="calc">Calculate</button>

      <div class="result" id="result" style="display:none;"></div>
      <div class="table" id="tableWrap" style="display:none;"></div>

      <p class="small" style="margin-top:12px;">
        <strong>Disclaimer:</strong> Results are estimates. Actual draw varies by hose length, injector condition,
        nozzle choice, temperature, and chemical viscosity. Brand names are used for identification only.
      </p>
    </div>
  </div>
<script>
const DRAW_NOTE =
  "Actual draw varies by hose length, injector condition, nozzle choice, temperature, and chemical viscosity.";

const INJECTORS = [
  { id:"supersuds", name:"Super Suds Sucker (est. 30%)", ratios:{4:2.333,5:2.333,6:2.333,7:2.333,8:2.333,9:2.333,10:2.333}},
  { id:"gp", name:"General Pump High Draw (20%)", ratios:{3:4,4:4,5:4}},
  { id:"o18", name:"Standard DS — Orifice 1.8", ratios:{2:9,3:9,4:9,5:9,6:9,7:9,8:9,9:9,10:9}},
  { id:"o21", name:"Standard DS — Orifice 2.1", ratios:{2:7,3:7,4:7,5:7,6:7,7:7,8:7,9:7,10:7}},
  { id:"o23", name:"Standard DS — Orifice 2.3", ratios:{2:5.667,3:5.667,4:5.667,5:5.667,6:5.667,7:5.667,8:5.667,9:5.667,10:5.667}}
];

const BATCHES = [1,5,10,15,20,30,55];

function round(n,d=2){ return Math.round(n*10**d)/10**d; }

function populate(){
  inj.innerHTML = INJECTORS.map(i=>`<option value="${i.id}">${i.name}</option>`).join("");
  gpm.innerHTML = Array.from({length:9},(_,i)=>i+2)
    .map(g=>`<option ${g===4?"selected":""}>${g}</option>`).join("");
}

function requiredTank(desired, ratio){ return desired*(ratio+1); }

function batch(volume, stock, tank){
  const chem = volume*(tank/stock);
  return { volume, chem, water: volume-chem };
}

calc.onclick = () => {
  const injector = INJECTORS.find(i=>i.id===inj.value);
  const r = injector.ratios[gpm.value];
  const stockVal = +stock.value;
  const desiredVal = +desired.value;

  if(!r){
    result.style.display="block";
    result.innerHTML = `<p class="big warn">Unsupported GPM</p><p class="small">${DRAW_NOTE}</p>`;
    tableWrap.style.display="none";
    return;
  }

  const tankPct = requiredTank(desiredVal, r);
  if(tankPct > stockVal){
    result.style.display="block";
    result.innerHTML = `
      <p class="big warn">Desired output unreachable</p>
      <p class="small">Max possible ≈ ${round(stockVal/(r+1),3)}%</p>
      <p class="small">${DRAW_NOTE}</p>`;
    tableWrap.style.display="none";
    return;
  }

  result.style.display="block";
  result.innerHTML = `
    <p class="big">Mix tank to ${round(tankPct,3)}%</p>
    <p class="small">${injector.name} @ ${gpm.value} GPM</p>
    <p class="small">${DRAW_NOTE}</p>`;

  tableWrap.style.display="block";
  tableWrap.innerHTML = `
    <table><thead><tr><th>Batch</th><th>Chem (gal)</th><th>Water (gal)</th></tr></thead>
    <tbody>${BATCHES.map(b=>{
      const m=batch(b,stockVal,tankPct);
      return `<tr><td>${b}</td><td>${round(m.chem)}</td><td>${round(m.water)}</td></tr>`;
    }).join("")}</tbody></table>`;
};

populate();
</script>
</body>
</html>
